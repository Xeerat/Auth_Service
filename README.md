# Backend-приложение: система аутентификации и авторизации

## Описание проекта

Данное backend-приложение реализует **собственную систему аутентификации и авторизации пользователей**.

Основная цель проекта — **разработка и описание собственной системы управления доступом к ресурсам**, включая:
- проектирование структуры базы данных;
- описание ролей, прав и ресурсов;
- реализацию проверки прав доступа на уровне API.

---

## Основной функционал

### 1. Взаимодействие с пользователем

Система предоставляет следующий функционал:

#### Регистрация пользователя
Пользователь может создать учетную запись, указав:
- Фамилию, имя, отчество;
- Email (уникальный);
- Пароль;
- Повтор пароля.

Пароль хранится в базе данных **в хэшированном виде**.

---

#### Авторизация (Login)
Пользователь входит в систему с помощью:
- email;
- пароля.

После успешного входа система:
- идентифицирует пользователя при последующих запросах;
- использует механизм токенов.

---

#### Logout
Пользователь выходит из системы, при этом:
- токен становится недействительным;
- дальнейшие запросы требуют повторной авторизации.

---

#### Обновление профиля
Авторизованный пользователь может:
- редактировать свои персональные данные;
- изменить пароль.

---

#### Удаление аккаунта (мягкое удаление)
Пользователь может инициировать удаление аккаунта:
- происходит автоматический logout;
- пользователь больше не может войти в систему;
- запись **не удаляется физически**, а помечается флагом:

```python
is_active = False
```

---

### 2. Система разграничения прав доступа

В приложении реализована кастомная ролевая система разграничения прав доступа, 
основанная на проверке роли пользователя при обращении к защищённым API-ресурсам.

#### Общая идея

Каждый пользователь:

- проходит аутентификацию по email и паролю;
- получает токен, который сохраняется в cookies;
- при каждом запросе к защищённому ресурсу автоматически проверяется:
    
    - факт авторизации;
    - роль пользователя;
    - право доступа к ресурсу.

Система реализована вручную с помощью декоратора.

---

### 3. Проверка авторизации и роли пользователя

Для ограничения доступа используется декоратор `@require_role`

#### Логика работы декоратора

- Из cookies извлекается токен
- Если токен отсутствует:
    
    - возвращается ошибка **401 Unauthorized**
- Токен декодируется, из него извлекается email пользователя
- Пользователь ищется в базе данных
- Если пользователь не найден или неактивен:

    - возвращается ошибка **401 Unauthorized**
- Проверяется роль пользователя:
    
    - если роль не соответствует требуемой — **403 Forbidden**
- При успешной проверке вызывается целевая функция API

#### Таким образом:

- **401** — пользователь не авторизован
- **403** — пользователь авторизован, но не имеет доступа

#### Пример декоратора ограничения доступа
```python
@require_role(role="admin")
```
Данный декоратор указывает, что доступ к фунции разрешён только пользователям с
ролью `admin`.   
Такая роль, для демонстрации, выдается первому зарегистрированному пользователю.

---

### 4. Административные ресурсы

В системе реализован набор функций, доступных исключительно администраторам.

#### Получение данных о пользователе
```http
GET /auth/data/
```
Позволяет администратору получить данные любого пользователя по email.

---

#### Управление административными правилами

Для демонстрации работы системы прав доступа реализован отдельный класс `AdminRules`,
содержащий набор правил администратора.

#### Просмотр правил
```http
GET /auth/rules
```
#### Добавление правила
```http
POST /auth/rules_add
```
#### Удаление правила
```http
POST /auth/rules_del
```

Все указанные функции защищены декоратором `@require_role(role="admin")`.

---

### 5. Класс AdminRules

Класс `AdminRules` реализует хранение и управление правилами, доступными только
администратору.

Особенности:

 - правила хранятся в виде словаря;
 - поддерживается добавление новых правил;
 - поддерживается удаление правил по номеру;
 - все изменения доступны только пользователю с ролью `admin`

 Данный класс не участвует напрямую в логике авторизации и используется исключительно для демонстрации работы системы прав доступа.